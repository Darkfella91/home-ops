apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: keycloak
spec:
  instances: 1
  image: ghcr.io/darkfella91/keycloak:latest@sha256:53f946c48f5444e014493dad93ea960ae2a778317917d8383e16b29ec6283d8f
  startOptimized: true
  imagePullSecrets:
    - name: github-credentials
  ingress:
    annotations:
      external-dns.alpha.kubernetes.io/target: external.${PUBLIC_DOMAIN}
    className: external
  http:
    tlsSecret: keycloak-tls
  hostname:
    hostname: https://auth.${PUBLIC_DOMAIN}
    admin: https://auth.${PUBLIC_DOMAIN}/admin
  unsupported:
    podTemplate:
      spec:
        containers:
          - volumeMounts:
              - name: cert
                mountPath: /etc/ssl/custom/certfile.pem
                subPath: tls.crt
              - name: cert
                mountPath: /etc/ssl/custom/keyfile.pem
                subPath: tls.key
        volumes:
          - name: cert
            secret:
              secretName: keycloak-tls
